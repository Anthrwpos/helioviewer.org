<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/**
<span class='line'>  2</span>  * @author Jaclyn Beck
<span class='line'>  3</span>  * @fileoverview A class that deals with using the imgAreaSelect plugin, which allows the user to click and drag 
<span class='line'>  4</span>  *                 to select a subregion of the image in the viewport. 
<span class='line'>  5</span>  */</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="COMM">/*jslint browser: true, white: true, onevar: true, undef: true, nomen: false, eqeqeq: true, plusplus: true, 
<span class='line'>  7</span> bitwise: true, regexp: true, strict: true, newcap: true, immed: true, maxlen: 120, sub: true */</span><span class="WHIT">
<span class='line'>  8</span> </span><span class="COMM">/*global Class, $, Shadowbox, setTimeout, window */</span><span class="WHIT">
<span class='line'>  9</span> </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 10</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ImageSelectTool</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Class.extend</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'> 11</span> </span><span class="WHIT">    </span><span class="COMM">/** @lends ImageSelectTool.prototype */</span><span class="WHIT">
<span class='line'> 12</span> </span><span class="WHIT">    </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 13</span> </span><span class="WHIT">        
<span class='line'> 14</span>     </span><span class="COMM">/**
<span class='line'> 15</span>      * @constructs
<span class='line'> 16</span>      * @description Sets up an event handler for the select region button and finds the divs where
<span class='line'> 17</span>      *                 the fake transparent image will be inserted
<span class='line'> 18</span>      * @param {Object} controller -- the helioviewer class
<span class='line'> 19</span>      */</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="WHIT">    </span><span class="NAME">init</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">controller</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 21</span> </span><span class="WHIT">        </span><span class="NAME">$.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// TODO (2009/09/10): Necessary?</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="WHIT">        </span><span class="NAME">this.button</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#select-region-button"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="WHIT">        </span><span class="NAME">this.controller</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">controller</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="WHIT">        </span><span class="NAME">this.active</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="WHIT">            
<span class='line'> 26</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="WHIT">    
<span class='line'> 28</span>         </span><span class="NAME">this.button.click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 29</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">imgContainer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">transImg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helioviewer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="WHIT">            
<span class='line'> 31</span>             </span><span class="COMM">// If the user has already pushed the button but not done anything, this will turn the feature off.</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.active</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">                </span><span class="NAME">self.cleanup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 35</span> 
<span class='line'> 36</span> </span><span class="WHIT">            </span><span class="COMM">// Otherwise, turn it on.</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="WHIT">                </span><span class="COMM">// Disable keyboard shortcuts for fullscreen mode</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="WHIT">                </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#fullscreen-btn"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'requests-disabled'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="WHIT">                </span><span class="NAME">self.active</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="WHIT">                </span><span class="NAME">helioviewer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.controller</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="WHIT">                
<span class='line'> 43</span>                 </span><span class="COMM">// Get viewport dimensions to make the transparent image with. </span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">                </span><span class="NAME">width</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helioviewer.viewport.dimensions.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">                </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helioviewer.viewport.dimensions.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">                
<span class='line'> 47</span>                 </span><span class="COMM">/* 
<span class='line'> 48</span>                  * Create a temporary transparent image that spans the height and width of the viewport.
<span class='line'> 49</span>                  * Necessary because the viewport image is done in tiles and imgAreaSelect cannot cross 
<span class='line'> 50</span>                  * over tile boundaries. Add the transparent image to the viewport, on top of the other tiles.
<span class='line'> 51</span>                  * 
<span class='line'> 52</span>                  * viewport.domNode corresponds to the div "#helioviewer-viewport", so add the tile directly
<span class='line'> 53</span>                  * inside this div. It is necessary to specify a z-index because otherwise it gets added underneath
<span class='line'> 54</span>                  * the rest of the tiles and the plugin will not work.
<span class='line'> 55</span>                  */</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="WHIT">                </span><span class="NAME">transImg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'&lt;img id="transparent-image" src="images/transparent_512.png" alt="" width="'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="WHIT">                           </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'" height="'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'" />'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">                </span><span class="NAME">transImg.css</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">'position'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'relative'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cursor'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'crosshair'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'z-index'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">                </span><span class="NAME">helioviewer.viewport.domNode.append</span><span class="PUNC">(</span><span class="NAME">transImg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">                
<span class='line'> 61</span>                 </span><span class="COMM">/* Make a temporary container for imgAreaSelect to put all of its divs into.
<span class='line'> 62</span>                  * Note that this container must be OUTSIDE of the viewport because otherwise the plugin's boundaries
<span class='line'> 63</span>                  * do not span the whole image for some reason. All of the divs are put in "#outside-box"
<span class='line'> 64</span>                  */</span><span class="WHIT">
<span class='line'> 65</span> </span><span class="WHIT">                </span><span class="NAME">imgContainer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'body'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">'&lt;div id="imgContainer">&lt;/div>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 66</span> </span><span class="WHIT">                
<span class='line'> 67</span>                 </span><span class="NAME">self.selectArea</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'> 70</span>     </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 71</span> 
<span class='line'> 72</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'> 73</span>      * @description Loads the imgAreaSelect plugin and uses it on the transparent image that covers the viewport.
<span class='line'> 74</span>      *                 The function imgAreaSelect() returns two variables, "img", which is the original transparent
<span class='line'> 75</span>      *                 image, and "selection", which is an array describing the selected area. Available data for 
<span class='line'> 76</span>      *                 "selection" is x1, y1, x2, y2, width, and height.
<span class='line'> 77</span>      *                 See http://odyniec.net/projects/imgareaselect/  for usage examples and documentation. 
<span class='line'> 78</span>      */</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">    </span><span class="NAME">selectArea</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">viewport</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visibleCoords</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 81</span> </span><span class="WHIT">        
<span class='line'> 82</span>         </span><span class="NAME">viewport</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.controller.viewport</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 83</span> </span><span class="WHIT">        
<span class='line'> 84</span>         </span><span class="COMM">// Use imgAreaSelect on the transparent region to get the top, left, bottom, and right </span><span class="WHIT">
<span class='line'> 85</span> </span><span class="WHIT">        </span><span class="COMM">// coordinates of the selected region. </span><span class="WHIT">
<span class='line'> 86</span> </span><span class="WHIT">        </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#transparent-image"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">imgAreaSelect</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'> 87</span>             </span><span class="NAME">handles</span><span class="PUNC">:</span><span class="WHIT">     </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 88</span> </span><span class="WHIT">            </span><span class="NAME">parent</span><span class="PUNC">:</span><span class="WHIT">        </span><span class="STRN">"#imgContainer"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 89</span> </span><span class="WHIT">            </span><span class="COMM">/* onSelectChange:    function (img, selection) {
<span class='line'> 90</span>                 helioviewer.messageConsole.info("Image dimensions: " + (selection.x2 - selection.x1) + "x" +
<span class='line'> 91</span>                                                 (selection.y2 - selection.y1) + " px");
<span class='line'> 92</span>             }, */</span><span class="WHIT">
<span class='line'> 93</span> </span><span class="WHIT">            
<span class='line'> 94</span>             </span><span class="NAME">onSelectEnd</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">img</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">    
<span class='line'> 95</span>                 </span><span class="COMM">// Get the coordinates of the selected image, and adjust them to be </span><span class="WHIT">
<span class='line'> 96</span> </span><span class="WHIT">                </span><span class="COMM">// heliocentric like the viewport coords. </span><span class="WHIT">
<span class='line'> 97</span> </span><span class="WHIT">                </span><span class="NAME">visibleCoords</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">viewport.getHCViewportPixelCoords</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 98</span> </span><span class="WHIT">                
<span class='line'> 99</span>                 </span><span class="NAME">coords</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>100</span> </span><span class="WHIT">                    </span><span class="NAME">top</span><span class="WHIT">        </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">visibleCoords.top</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">selection.y1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">                    </span><span class="NAME">left</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">visibleCoords.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">selection.x1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">                    </span><span class="NAME">bottom</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">visibleCoords.top</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">selection.y2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>103</span> </span><span class="WHIT">                    </span><span class="NAME">right</span><span class="WHIT">    </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">visibleCoords.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">selection.x2</span><span class="WHIT">
<span class='line'>104</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>105</span> </span><span class="WHIT">                
<span class='line'>106</span>                 </span><span class="COMM">//Pop up a dialog box in shadowbox asking the user what they want to do with it.                 </span><span class="WHIT">
<span class='line'>107</span> </span><span class="WHIT">                </span><span class="NAME">self.createDialog</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>108</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>109</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>111</span> 
<span class='line'>112</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>113</span>      * @description Loads a dialog pop-up that asks the user what they would like to do with the region they selected.
<span class='line'>114</span>      *                 Current options are: "Take Screenshot", "Build Movie", and "Cancel".
<span class='line'>115</span>      * @param {Array} coords -- an array of the heliocentric top, left, right, and bottom coordinates of the selected 
<span class='line'>116</span>      *                          region, relative to the viewport coordinates.
<span class='line'>117</span>      */</span><span class="WHIT">    
<span class='line'>118</span> 
<span class='line'>119</span>     </span><span class="NAME">createDialog</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>121</span> 
<span class='line'>122</span> </span><span class="WHIT">        </span><span class="NAME">Shadowbox.open</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>123</span> </span><span class="WHIT">            </span><span class="NAME">options</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>124</span> </span><span class="WHIT">                </span><span class="NAME">onFinish</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>125</span> </span><span class="WHIT">                    </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#take-screenshot-button'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>126</span> </span><span class="WHIT">                        </span><span class="NAME">self.cleanup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">                        </span><span class="NAME">self.controller.screenshotBuilder.takeScreenshot</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>128</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>129</span> </span><span class="WHIT">                    
<span class='line'>130</span>                     </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cancel-button'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">                        </span><span class="NAME">self.cleanup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>133</span> </span><span class="WHIT">                    
<span class='line'>134</span>                     </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#build-movie-button'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">                        </span><span class="NAME">self.cleanup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">                        </span><span class="COMM">// Delay the action for one second so Shadowbox doesn't crash </span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">                        </span><span class="COMM">// from opening and closing at the same time.</span><span class="WHIT">
<span class='line'>138</span> </span><span class="WHIT">                        </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>139</span> </span><span class="WHIT">                            </span><span class="NAME">self.controller.movieBuilder.checkMovieLayers</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                                
<span class='line'>140</span>                         </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                
<span class='line'>141</span>                     </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>142</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">            
<span class='line'>143</span> 
<span class='line'>144</span>             </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>145</span> 
<span class='line'>146</span> </span><span class="WHIT">            </span><span class="NAME">player</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="STRN">'html'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>147</span> </span><span class="WHIT">            </span><span class="NAME">width</span><span class="PUNC">:</span><span class="WHIT">     </span><span class="NUMB">500</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">            </span><span class="NAME">height</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">160</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">            </span><span class="NAME">title</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="STRN">'Select Region Options'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">            </span><span class="NAME">content</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="STRN">'&lt;div id="shadowbox-form" class="ui-widget-content ui-corner-all" '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">                        </span><span class="STRN">'style="margin: 10px; padding: 20px; height: 100px; font-size: 12pt;">'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT">                            </span><span class="STRN">'&lt;h2 style="font-size: 14pt;">What would you like to do with the selected region?&lt;/h2>'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>153</span> </span><span class="WHIT">                            </span><span class="STRN">'&lt;br />'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>154</span> </span><span class="WHIT">                            </span><span class="STRN">'&lt;div id="buttons" style="text-align: left; float: right;">'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>155</span> </span><span class="WHIT">                                </span><span class="STRN">'&lt;button id="cancel-button" class="ui-state-default ui-corner-all">Cancel&lt;/button>'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>156</span> </span><span class="WHIT">                                </span><span class="STRN">'&lt;button id="build-movie-button" class="ui-state-default ui-corner-all">'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span class='line'>157</span>                                 </span><span class="STRN">'Build Movie&lt;/button>'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">                                </span><span class="STRN">'&lt;button id="take-screenshot-button" class="ui-state-default ui-corner-all">'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span class='line'>159</span>                                 </span><span class="STRN">'Take Screenshot&lt;/button>'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">                            </span><span class="STRN">'&lt;/div>'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span class='line'>161</span>                         </span><span class="STRN">'&lt;/div>'</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    
<span class='line'>163</span>     </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>164</span> 
<span class='line'>165</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>166</span>      * Removes all divs created by imgAreaSelect. Also closes Shadowbox.
<span class='line'>167</span>      * @param imgContainer -- has all imgAreaSelect divs inside
<span class='line'>168</span>      * @param transImg -- temporary transparent image that imgAreaSelect is used on.
<span class='line'>169</span>      * @TODO: add error checking if the divs are already gone for whatever reason.
<span class='line'>170</span>      */</span><span class="WHIT">    
<span class='line'>171</span>     </span><span class="NAME">cleanup</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>172</span> </span><span class="WHIT">        </span><span class="NAME">Shadowbox.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>173</span> </span><span class="WHIT">        
<span class='line'>174</span>         </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#imgContainer, #transparent-image'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>175</span> </span><span class="WHIT">        
<span class='line'>176</span>         </span><span class="NAME">this.active</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>177</span> </span><span class="WHIT">        </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#fullscreen-btn"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeClass</span><span class="PUNC">(</span><span class="STRN">'requests-disabled'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>178</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>179</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>180</span> </span></pre></body></html>